<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,
                                   initial-scale=1,
                                   minimum-scale=1,
                                   maximum-scale=1,
                                   user-scalable=no,
                                   minimal-ui">
  
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
  
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
    <title>Verifying the Vanadium Authentication Protocol - Vanadium</title>
  
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300italic,400,400italic,500,500italic,700,700italic|Source+Code+Pro">
  
    <link rel="stylesheet" href="/css/github.css">
    <link rel="stylesheet" href="/css/material.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  
    <script src="/js/react-0.14.3.min.js"></script>
    <script src="/js/react-dom-0.14.3.min.js"></script>
  
    <link rel="apple-touch-icon" sizes="57x57" href="/favicons/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/favicons/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/favicons/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/favicons/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/favicons/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/favicons/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/favicons/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/favicons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/favicons/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="160x160" href="/favicons/favicon-160x160.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/favicons/favicon-192x192.png">
    <meta name="msapplication-TileColor" content="#00acc1">
    <meta name="msapplication-TileImage" content="/favicons/mstile-144x144.png">
  
    <link rel="stylesheet" href="/css/bundle.css">
    <script src="/js/bundle.js"></script>
  </head>
  <body>
    <header class="mdl-shadow--2dp">
      <div class="row">
        <div class="icon menu"><i class="material-icons">menu</i></div>
        <div class="icon v-icon"><img src="/images/v-icon-white.svg"></div>
        <div class="logo"><a href="/">Vanadium</a></div>
        <div class="spacer"></div>
        <nav>
          <a href="/">Overview</a>
          <a href="/installation/">Installation</a>
          <a href="/tutorials/hello-world.html">Tutorials</a>
        </nav>
      </div>
    </header>
    <div class="sidebar"></div>
    <div class="sidebar-data">
      <a href="/">Overview</a>
      <a href="/installation/">Installation</a>
    
      <a href="#" class="nav">Tutorials</a>
      <nav>
        <a href="/tutorials/hello-world.html">Hello World</a>
        <a href="/tutorials/basics.html">Client/Server Basics</a>
    
        <a href="#" class="nav">Security</a>
        <nav>
          <a href="/tutorials/security/">Overview</a>
          <a href="/tutorials/security/principals-and-blessings.html">Principals and Blessings</a>
      <a href="/tutorials/security/permissions-authorizer.html">Permissions Authorizer</a>
      <a href="/tutorials/security/first-party-caveats.html">Caveats</a>
      <a href="/tutorials/security/third-party-caveats.html">Third-party Caveats</a>
      <a href="/tutorials/security/agent.html">The Agent</a>
      <a href="/tutorials/security/custom-authorizer.html">Custom Authorizer</a>
    </nav>
    
        <a href="#" class="nav">Naming</a>
        <nav>
          <a href="/tutorials/naming/">Overview</a>
          <a href="/tutorials/naming/mount-table.html">The Mount Table</a>
      <a href="/tutorials/naming/namespace.html">Namespaces</a>
      <a href="/tutorials/naming/suffix-part1.html">The Suffix - Part I</a>
      <a href="/tutorials/naming/suffix-part2.html">The Suffix - Part II</a>
      <a href="/tutorials/naming/globber.html">Globber</a>
    </nav>
    
        <a href="#" class="nav">Java</a>
        <nav>
          <a href="/tutorials/java/">Overview</a>
          <a href="/tutorials/java/fortune.html">Fortune in Java</a>
      <a href="/tutorials/java/android.html">Location Service in Android</a>
    </nav>
    
        <a href="#" class="nav">JavaScript</a>
        <nav>
          <a href="/tutorials/javascript/">Overview</a>
          <a href="/tutorials/javascript/hellopeer.html">Hello Peer</a>
      <a href="/tutorials/javascript/fortune.html">Fortune in JS</a>
      <a href="/tutorials/javascript/security.html">Security in JS</a>
    </nav>
    
        <a href="/tutorials/faq.html">Tutorial FAQ</a>
      </nav>
    
      <a href="#" class="nav">Concepts</a>
      <nav>
        <a href="/concepts/rpc.html">RPC System</a>
    <a href="/concepts/naming.html">Naming</a>
    <a href="/concepts/security.html">Security</a>
    <a href="/concepts/device-management.html">Device Management</a>
    <a href="/concepts/syncbase-overview.html">Syncbase</a>
  </nav>
    
      <a href="/example-apps.html">Example Apps</a>
      <a href="/api-reference.html">API Reference</a>
    
      <a href="#" class="nav">Community</a>
      <nav>
        <a href="/community/coding-guidelines.html">Coding Guidelines</a>
    <a href="/community/contributing.html">Contributing</a>
  </nav>
    
      <a href="#" class="nav">Tools</a>
      <nav>
        <a href="/tools/identity-service-faq.html">Vanadium Identity Service</a>
    <a href="/tools/jiri.html">Jiri</a>
    <a href="/tools/services.html">Vanadium Cloud Services</a>
    <a href="/tools/vanadium-chrome-extension.html">Vanadium Chrome Extension</a>
  </nav>
    
      <a href="#" class="nav">Design Docs</a>
      <nav>
        <a href="/designdocs/authentication.html">Authentication Protocol</a>
    <a href="/designdocs/identity-service.html">Identity Service</a>
    <a href="/designdocs/vdl-spec.html">VDL Specification</a>
    <a href="/designdocs/vom-spec.html">VOM Specification</a>
  </nav>
    
      <a href="/glossary.html">Glossary</a>
      <a href="/faq.html">FAQ</a>
      <a href="/tos.html">Terms of Service</a>
    </div>
    <main>
      <h1 class="title">
        
        Verifying the Vanadium Authentication Protocol
      </h1>

      <div class="toc"></div>

      <p>This project defines a formalization of the <a href="/designdocs/authentication.html">Vanadium authentication protocol</a>
and verifies the desired security properties for it using the automatic cryptographic protocol verifier <a href="http://prosecco.gforge.inria.fr/personal/bblanche/proverif/">ProVerif</a>.</p>
<p>The authentication protocol is used during a <a href="/concepts/rpc.html">Vanadium RPC</a> for mutual
authentication and setting up an encrypted channel for sending RPC data.
More specifically, the protocol allows each end of an RPC to exchange <a href="/glossary.html#blessings">blessings</a>
with the other end and verify that the other end possesses the private key corresponding
to the public key to which its blessings are bound. At the end of the protocol,
an encrypted channel is established between the two ends for performing the
RPC. The blessings learned as part of the authentication may be used to
authorize the RPC (e.g., by checking that the blessing name is present on
a particular <a href="/glossary.html#access-list">access list</a>).</p>
<p>The design of the protocol is very similar to the <a href="http://webee.technion.ac.il/~hugo/sigma.html">SIGMA-I</a> protocol from
the literature. It involves a <a href="https://en.wikipedia.org/wiki/Elliptic_curve_Diffie%E2%80%93Hellman">Diffie-Hellman key exchange</a>, followed by an
exchange of blessings and private key possession proofs. However, the protocol
differs from SIGMA-I in how this private key possession proof is represented. We
refer the reader to the <a href="/designdocs/authentication.html">design doc</a> for a detailed specification of the
protocol.</p>
<p>Decades of research in protocol design has shown that manually assessing the
security of a protocol is challenging as it is difficult to enumerate and
examine all possible attack scenarios. There have been a number of instances
of published protocols that intuitively seemed secure but had serious
vulnerabilities, e.g., the <a href="https://en.wikipedia.org/wiki/Needham%E2%80%93Schroeder_protocol">Needham-Schroeder protocol</a>. The only way to
guarantee security of a protocol is to formally specify it and mathematically
prove its security properties.</p>
<h1 id="proverif">ProVerif</h1>
<p><a href="http://prosecco.gforge.inria.fr/personal/bblanche/proverif/">ProVerif</a> is a tool for automatically analyzing properties of security
protocols. It is capable of proving reachability properties, correspondence assertions,
and observational equivalence properties of protocols. The ProVerif specification language
is a variant of the <a href="http://crysys.hu/members/tvthong/pispi/applied.pdf">applied pi-calculus</a>. We refer the reader to the
<a href="http://prosecco.gforge.inria.fr/personal/bblanche/proverif/manual.pdf">ProVerif manual</a> for the authoritative definition of the language.</p>
<p>ProVerif analyzes protocols in the symbolic, <a href="https://en.wikipedia.org/wiki/Dolev%E2%80%93Yao_model">Dolev-Yao</a> attacker model.
In this model, the attacker controls the communication channel between the protocol
participants and can read, modify, delete and inject messages. But the attacker
cannot &quot;break&quot; cryptographic primitives and can only use them via their legitimate
interfaces. For instance, the attacker can only decrypt those encrypted messages for
which it knows the encryption key.</p>
<p>ProVerif is sound but not complete. This means that if ProVerif confirms
that a security property is true then the property is indeed true in the Dolev-Yao attacker
model. However, not all true properties may be provable by ProVerif.</p>
<h1 id="protocol-formalization">Protocol Formalization</h1>
<p>The complete formalization of the authentication protocol along with all cryptographic
primitives, and Vanadium primitives (such as: certificates and blessings) is specified
in <a href="/proofs/authentication/protocol.pv"><code>protocol.pv</code></a>. The steps of the protocol are captured in the process
<code>handshake</code> that is parametric on the blessing and private key of the dialer and
the acceptor. Dialer (aka client) is the initiator of the first handshake message
and Acceptor (aka server) is the responder of the first handshake message.</p>
<h1 id="security-properties">Security Properties</h1>
<p>We verify three key properties of the authentication protocol.</p>
<p>(1) <em>Mutual Authentication</em>: The dialer and acceptor must agree on the
    established encryption key and each others blessings. This property
    is formalized as a pair of correspondence properties in ProVerif stating that a
    acceptor accepts a session if and only if the dialer accepts the same
    session, where a session is defined by the session encryption key and
    the public keys of the dialer&#39;s and acceptor&#39;s blessings.</p>
<p>(2) <em>Channel Confidentiality</em>: The session encryption key established
    is protected from attackers. This property is verified by checking
    that a message encrypted under the session key and sent from the
    acceptor to the dialer is not revealed to the attacker. This is specified
    as a reachability property in ProVerif.</p>
<p>(3) <em>Dialer Privacy</em>: The dialer&#39;s public key is never revealed to the attacker. This
    is specified as a reachability property in ProVerif. The acceptor&#39;s public key does get
    revealed to the attacker, and we verify this using another reachability
    property in ProVerif.</p>
<p>We verify security properties for an instantiation of the protocol process
(<code>authProtocol</code>) with randomly chosen private keys for the dialer and acceptor,
and randomly chosen blessings of depth two for the dialer and acceptor. We note
that the depth of the blessings in the instantiation should not affect the
security properties, i.e., the verification should go through for arbitrary
depth blessings if it goes through for depth two blessings. However, a formal
proof of this statement remains to be shown.</p>
<h1 id="running-the-verification">Running the Verification</h1>
<h2 id="installing-proverif">Installing ProVerif</h2>
<p>Running the verification requires installing the <a href="http://prosecco.gforge.inria.fr/personal/bblanche/proverif/">ProVerif</a> tool.
Instructions for installing the tool can be found <a href="http://prosecco.gforge.inria.fr/personal/bblanche/proverif/README">here</a></p>
<h2 id="running-proverif">Running ProVerif</h2>
<p>Once ProVerif is installed, please set the environment variable
<code>PROVERIF</code> to point at the ProVerif binary.</p>
<pre><code>export PROVERIF=&lt;path to ProVerif binary&gt;
</code></pre><p>The verification can be run using the following command.</p>
<pre><code>$PROVERIF protocol.pv
</code></pre><h2 id="intrepting-the-results">Intrepting the results</h2>
<p>The aforesaid command prints out a bunch of ProVerif messages (we recommend
reading Section 3 of the <a href="http://prosecco.gforge.inria.fr/personal/bblanche/proverif/manual.pdf">ProVerif manual</a> to understand
these messages) with the verification results for the various properties
printed towards the end.</p>
<p>A simple way of printing just the verification results is to run the following
command:</p>
<pre><code>$PROVERIF protocol.pv | grep RESULT
</code></pre><p>This command should print the following:</p>
<p>(We add line numbers for ease of reading.)</p>
<pre><code>1. RESULT not attacker(publicKey(privKeyAcceptor[])) is false.

2. RESULT not attacker(publicKey(privKeyDialer[])) is true.

3. RESULT not attacker(privKeyAcceptor[]) is true.

4. RESULT not attacker(privKeyDialer[]) is true.

5. RESULT not attacker(secretMessage[]) is true.

6. RESULT event(termDialer(k,publicKey(privKeyDialer[]),publicKey(privKeyAcceptor[]))) ==&gt; event(acceptsAcceptor(k,publicKey(privKeyDialer[]),publicKey(privKeyAcceptor[]))) is true.

7. RESULT event(acceptsAcceptor(k,publicKey(privKeyDialer[]),publicKey(privKeyAcceptor[]))) ==&gt; event(acceptsDialer(k,publicKey(privKeyDialer[]),publicKey(privKeyAcceptor[]))) is true.
</code></pre><p>The first two messages respectively state that the attacker learns the
public key of the acceptor but not the dialer. This verifies the <em>dialer privacy</em>
property.</p>
<p>The next three messages respectively state that the attacker <em>does not</em>
learn the private key of the acceptor, the private key of the dialer, and
the secret message sent by the acceptor to the dialer over the established
encrypted channel. This verifies the <em>channel secrecy</em> property.</p>
<p>The last two messages state two correspondence properties that
together imply that a dialer accepts a certain session if and
only if the acceptor also accepts the same session, where a session
is defined by the session encryption key and the public keys of
the dialer&#39;s and acceptor&#39;s blessings. This verifies the <em>mutual authentication</em>
property.</p>

    </main>
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-59720824-6', 'auto');
        ga('send', 'pageview');
    </script>
  </body>
</html>
