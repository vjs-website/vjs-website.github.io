<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,
                                   initial-scale=1,
                                   minimum-scale=1,
                                   maximum-scale=1,
                                   user-scalable=no,
                                   minimal-ui">
  
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
  
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
    <title>Permissions Authorizer - Vanadium</title>
  
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300italic,400,400italic,500,500italic,700,700italic|Source+Code+Pro">
  
    <link rel="stylesheet" href="/css/github.css">
    <link rel="stylesheet" href="/css/material.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  
    <script src="/js/react-0.14.3.min.js"></script>
    <script src="/js/react-dom-0.14.3.min.js"></script>
  
    <link rel="apple-touch-icon" sizes="57x57" href="/favicons/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/favicons/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/favicons/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/favicons/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/favicons/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/favicons/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/favicons/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/favicons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/favicons/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="160x160" href="/favicons/favicon-160x160.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/favicons/favicon-192x192.png">
    <meta name="msapplication-TileColor" content="#00acc1">
    <meta name="msapplication-TileImage" content="/favicons/mstile-144x144.png">
  
    <link rel="stylesheet" href="/css/bundle.css">
    <script src="/js/bundle.js"></script>
  </head>
  <body>
    <header class="mdl-shadow--2dp">
      <div class="row">
        <div class="icon menu"><i class="material-icons">menu</i></div>
        <div class="icon v-icon"><img src="/images/v-icon-white.svg"></div>
        <div class="logo"><a href="/">Vanadium</a></div>
        <div class="spacer"></div>
        <nav>
          <a href="/">Overview</a>
          <a href="/installation/">Installation</a>
          <a href="/tutorials/hello-world.html">Tutorials</a>
        </nav>
      </div>
    </header>
    <div class="sidebar"></div>
    <div class="sidebar-data">
      <a href="/">Overview</a>
      <a href="/installation/">Installation</a>
    
      <a href="#" class="nav">Tutorials</a>
      <nav>
        <a href="/tutorials/hello-world.html">Hello World</a>
        <a href="/tutorials/basics.html">Client/Server Basics</a>
    
        <a href="#" class="nav">Security</a>
        <nav>
          <a href="/tutorials/security/">Overview</a>
          <a href="/tutorials/security/principals-and-blessings.html">Principals and Blessings</a>
      <a href="/tutorials/security/permissions-authorizer.html">Permissions Authorizer</a>
      <a href="/tutorials/security/first-party-caveats.html">Caveats</a>
      <a href="/tutorials/security/third-party-caveats.html">Third-party Caveats</a>
      <a href="/tutorials/security/agent.html">The Agent</a>
      <a href="/tutorials/security/custom-authorizer.html">Custom Authorizer</a>
    </nav>
    
        <a href="#" class="nav">Naming</a>
        <nav>
          <a href="/tutorials/naming/">Overview</a>
          <a href="/tutorials/naming/mount-table.html">The Mount Table</a>
      <a href="/tutorials/naming/namespace.html">Namespaces</a>
      <a href="/tutorials/naming/suffix-part1.html">The Suffix - Part I</a>
      <a href="/tutorials/naming/suffix-part2.html">The Suffix - Part II</a>
      <a href="/tutorials/naming/globber.html">Globber</a>
    </nav>
    
        <a href="#" class="nav">Java</a>
        <nav>
          <a href="/tutorials/java/">Overview</a>
          <a href="/tutorials/java/fortune.html">Fortune in Java</a>
      <a href="/tutorials/java/android.html">Location Service in Android</a>
    </nav>
    
        <a href="#" class="nav">JavaScript</a>
        <nav>
          <a href="/tutorials/javascript/">Overview</a>
          <a href="/tutorials/javascript/hellopeer.html">Hello Peer</a>
      <a href="/tutorials/javascript/fortune.html">Fortune in JS</a>
      <a href="/tutorials/javascript/security.html">Security in JS</a>
    </nav>
    
        <a href="/tutorials/faq.html">Tutorial FAQ</a>
      </nav>
    
      <a href="#" class="nav">Concepts</a>
      <nav>
        <a href="/concepts/rpc.html">RPC System</a>
    <a href="/concepts/naming.html">Naming</a>
    <a href="/concepts/security.html">Security</a>
    <a href="/concepts/device-management.html">Device Management</a>
    <a href="/concepts/syncbase-overview.html">Syncbase</a>
  </nav>
    
      <a href="/example-apps.html">Example Apps</a>
      <a href="/api-reference.html">API Reference</a>
    
      <a href="#" class="nav">Community</a>
      <nav>
        <a href="/community/coding-guidelines.html">Coding Guidelines</a>
    <a href="/community/contributing.html">Contributing</a>
  </nav>
    
      <a href="#" class="nav">Tools</a>
      <nav>
        <a href="/tools/identity-service-faq.html">Vanadium Identity Service</a>
    <a href="/tools/jiri.html">Jiri</a>
    <a href="/tools/services.html">Vanadium Cloud Services</a>
    <a href="/tools/vanadium-chrome-extension.html">Vanadium Chrome Extension</a>
  </nav>
    
      <a href="#" class="nav">Design Docs</a>
      <nav>
        <a href="/designdocs/authentication.html">Authentication Protocol</a>
    <a href="/designdocs/identity-service.html">Identity Service</a>
    <a href="/designdocs/vdl-spec.html">VDL Specification</a>
    <a href="/designdocs/vom-spec.html">VOM Specification</a>
  </nav>
    
      <a href="/glossary.html">Glossary</a>
      <a href="/faq.html">FAQ</a>
      <a href="/tos.html">Terms of Service</a>
    </div>
    <main>
      <h1 class="title">
        
        Permissions Authorizer
      </h1>

      <p class="wherein"><strong>Wherein</strong> you meet a built-in authorizer that that lets Alice grant fine-grained access to Bob and Carol with simple lists of names.</p>

      <div class="toc"></div>

      <div class="prerequisites">
      <div class="note info"><p><strong>Prerequisites</strong>:<br>
All tutorials require Vanadium <a href="/installation/">installation</a>, and must run in a <a href="/tutorials/faq.html#why-bash-">bash shell</a>.
<br>Further, please <a href="/sh/scenario-c-setup.sh" download="scenario-c-setup.sh"> download this script</a> then <a href="/tutorials/faq.html#why-source-">source</a> it:</p>
<pre><code>source ~/Downloads/scenario-c-setup.sh
</code></pre><p>This command wipes tutorial files and defines shell environment variables. If you start a new terminal, and just want to re-establish the environment, see instructions <a href="/tutorials/setup.html">here</a>.
</p>
<p></p>
<p>
If you would like to generate files from this tutorial without the copy/paste steps, download and source <a href="/sh/tut-completer-permissions-authorizer.sh" download="tut-completer-permissions-authorizer.sh">this script</a>. Files will be created in the <code>$V_TUT</code> <a href="/tutorials/setup.html">directory</a>.
</p>
</div>
</div>

      <h1 id="permissions-policy">Permissions policy</h1>
<p>In addition to the <a href="/tutorials/security/principals-and-blessings.html#default-authorization-policy">default authorization policy</a>, Vanadium
offers another built-in authorization policy based on the commonly used idea of
a permissions map.  Such an authorizer allows a wide range of policies
controllable via editing lists that are given to a server as flags - no need to
modify code.</p>
<div class="note info"><p>Vanadium also supports the use of a completely custom policy - the
procedure for building one is covered in the <a href="/tutorials/security/custom-authorizer.html">custom authorizer
tutorial</a>.</p>
</div>

<p>Permission maps define a list of blessings that should be given (or denied)
access to an object. All methods on objects can have <em>tags</em> on them and the
access list used for the method is selected based on that tag.  This is
inspired by <a href="http://en.wikipedia.org/wiki/Role-based_access_control">Role Based Access Control</a>.</p>
<p>To see how this works, assume Alice wants to let her family read and
write to her service but confine her friends to read operations only,
which don&#39;t change state.</p>
<p>To do so Alice defines two new tags, <em>Reader</em> and <em>Writer</em>, and adds
them to the service VDL:</p>
<!-- @fortuneInterfaceWithTags @test @completer -->
<pre><code> cat - &lt;&lt;EOF &gt;$V_TUT/src/fortune/ifc/fortune.vdl
package ifc

type MyTag string
const (
  Reader = MyTag(&quot;R&quot;)
  Writer = MyTag(&quot;W&quot;)
)

type Fortune interface {
  // Returns a random fortune.
  Get() (Fortune string | error) {Reader}
  // Adds a fortune to the set used by Get().
  Add(Fortune string) error {Writer}
}
EOF

VDLROOT=$V23_RELEASE/src/v.io/v23/vdlroot \
    VDLPATH=$V_TUT/src \
    $V_BIN/vdl generate --lang go $V_TUT/src/fortune/ifc
go build fortune/ifc
</code></pre><p>To exploit this a <strong>new authorizer</strong> is needed - one
that honors permissions provided at the server
command line:</p>
<!-- @permissionsAuthorizer @test @completer -->
<pre><code> cat - &lt;&lt;EOF &gt;$V_TUT/src/fortune/server/util/authorizer.go
package util

import (
  &quot;bytes&quot;
  &quot;flag&quot;
  &quot;fortune/ifc&quot;
  &quot;v.io/v23/security&quot;
  &quot;v.io/v23/security/access&quot;
  &quot;v.io/v23/vdl&quot;
)

var (
    perms = flag.String(&quot;perms&quot;, &quot;&quot;,
      &quot;JSON-encoded access.Permissions.&quot;)
)

func MakeAuthorizer() (authorizer security.Authorizer) {
  aMap, _ := access.ReadPermissions(
      bytes.NewBufferString(*perms))
  typ := vdl.TypeOf(ifc.Reader)
  authorizer, _ = access.PermissionsAuthorizer(aMap, typ)
  return
}
EOF

go install fortune/server
</code></pre><h2 id="a-specific-permissions-map">A specific permissions map</h2>
<p>Now restart the server with a <em>permissions map</em> that
allows <strong>family</strong> to read and write and <strong>friends</strong> to read only:</p>
<!-- @startServerWithPerms @test @sleep -->
<pre><code>kill_tut_process TUT_PID_SERVER
$V_TUT/bin/server \
    --v23.credentials $V_TUT/cred/alice \
    --endpoint-file-name $V_TUT/server.txt \
    --perms &#39;{&quot;R&quot;: {&quot;In&quot;: [&quot;alice:family&quot;,
                           &quot;alice:friend&quot;]},
              &quot;W&quot;: {&quot;In&quot;: [&quot;alice:family&quot;]}}&#39; &amp;
TUT_PID_SERVER=$!
</code></pre><p>This takes the form of a map.  The keys are the service method labels
(<code>R</code> is an abbreviation for <code>Reader</code>, a label on <code>Get</code>), and the
values are lists of blessing patterns.  Principals with blessings matching
a pattern in the &#39;In&#39; list can make the call.  An optional list called
<code>NotIn</code> specifies <em>exclusions</em> from the <code>In</code> list (e.g., you might let in <code>family</code>,
but exclude <code>family:uncle</code>).</p>
<p>Patterns are slash-separated strings that may optionally end in a <code>$</code>.  The
pattern <code>alice:houseguest</code> will be matched by the names <code>alice:houseguest</code> and
its delegates <code>alice:houseguest:bob</code>, <code>alice:houseguest:bob:spouse</code> etc., but
not by the name <code>bob</code> or <code>alice:colleague</code> or prefixes of the pattern like
<code>alice</code>.  On the other hand, the pattern <code>alice:houseguest:$</code> would be matched
exactly by the name <code>alice:houseguest</code>.</p>
<h2 id="impact-on-bob-and-carol">Impact on Bob and Carol</h2>
<p>You can quickly confirm that Bob (already <a href="/tutorials/security/principals-and-blessings.html#blessings">blessed as a
<code>friend</code></a>) can read:</p>
<!-- @bobCanRead @test -->
<pre><code>$V_TUT/bin/client \
    --v23.credentials $V_TUT/cred/bob \
    --server `cat $V_TUT/server.txt`
</code></pre><p>But Bob cannot write (he&#39;s not family):</p>
<!-- @bobCannotWrite -->
<pre><code>$V_TUT/bin/client \
    --v23.credentials $V_TUT/cred/bob \
    --server `cat $V_TUT/server.txt` \
    --add &#39;Bob is awesome.&#39;
</code></pre><p>Introduce Carol:</p>
<!-- @createCarol @test @completer -->
<pre><code>$V_BIN/principal create --overwrite $V_TUT/cred/carol carol
</code></pre><p>At this point no request from Carol will succeed because Carol is
unknown to Alice.</p>
<p>Suppose Carol is Alice&#39;s sister and Alice gives Carol the blessing
<code>alice:family:sister</code>:</p>
<!-- @aliceBlessCarolAsSister @test @completer -->
<pre><code>$V_BIN/principal bless \
    --v23.credentials $V_TUT/cred/alice \
    --for=24h $V_TUT/cred/carol family:sister | \
        $V_BIN/principal set \
            --v23.credentials $V_TUT/cred/carol \
            forpeer - alice
</code></pre><p>Now that Carol is seen as part of the family she&#39;ll be able to invoke
both <code>Get</code> and <code>Add</code>:</p>
<!-- @clientIsCarol @test -->
<pre><code>$V_TUT/bin/client \
    --v23.credentials $V_TUT/cred/carol \
    --server `cat $V_TUT/server.txt`

$V_TUT/bin/client \
    --v23.credentials $V_TUT/cred/carol \
    --server `cat $V_TUT/server.txt` \
    --add &#39;Eat kale.&#39;
</code></pre><p><img src="/images/tut/security04-alice-carol-succeed-bob-fails.svg" alt="Alice&#39;s permissions policy allows Carol to Get and Add data to the server, but Bob can only Get"></p>
<p>We&#39;re done with the server now.</p>
<!-- @killServer @test -->
<pre><code>kill_tut_process TUT_PID_SERVER
</code></pre><h1 id="summary">Summary</h1>
<ul>
<li><p>Vanadium provides a pre-built <em>Permissions authorizer</em>.</p>
</li>
<li><p>Service methods defined in a VDL file can be tagged with <em>roles</em>,
e.g. Reader and Writer.</p>
</li>
<li><p>A server built with the Permissions authorizer accepts a flag mapping roles
to lists of blessings.</p>
</li>
<li><p>A client blessed to a role is able to call the corresponding methods.</p>
</li>
</ul>

    </main>
    <nav class="previous-next">
      <a href="/tutorials/security/principals-and-blessings.html" class="previous">
        <div class="icon"><i class="material-icons">arrow_back</i></div>
        <div class="text-wrapper">
          <small>Previous</small>
          <div class="text">
            <span>Principals and Blessings</span>
          </div>
        </div>
      </a>
  <a href="/tutorials/security/first-party-caveats.html" class="next">
        <div class="text-wrapper">
          <small>Next</small>
          <div class="text">
            <span>Caveats</span>
          </div>
        </div>
        <div class="icon"><i class="material-icons">arrow_forward</i></div>
      </a>
</nav>
  </body>
</html>
